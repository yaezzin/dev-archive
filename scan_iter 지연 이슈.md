## SCAN 

```CAN cursor [MATCH pattern] [COUNT count]```

`cursor`

- ë°˜ë³µ ìœ„ì¹˜ë¥¼ ë‚˜íƒ€ë‚´ëŠ” ìˆ«ì
- ì‹œì‘ì€ 0, ë°˜ë³µ ì¢…ë£Œ ì‹œ ì‘ë‹µìœ¼ë¡œ cursor=0ì´ ë‚˜ì˜¤ë©´ ì™„ë£Œ

`MATCH`

- íŒ¨í„´ì„ í†µí•´ Like ì¡°íšŒë¥¼ ì§€ì›

`COUNT`

- ê¸°ë³¸ê°’ì€ **10**
- COUNTì˜ í¬ê¸°ë¥¼ í†µí•´ ë¶„í•  ê±´ìˆ˜ ì¡°ì • ê°€ëŠ¥

## KEY

```KEYS pattern```

- ì§€ì •ëœ íŒ¨í„´ì— ì¼ì¹˜í•˜ëŠ” ëª¨ë“  í‚¤ë¥¼ í•œ ë²ˆì— ë°˜í™˜
- RedisëŠ” ë‹¨ì¼ ìŠ¤ë ˆë“œë¡œ ë™ì‘í•˜ê¸° ë•Œë¬¸ì—, KEYS ì²˜ëŸ¼ì‹œê°„ì´ ì˜¤ë˜ ê±¸ë¦¬ëŠ” ì‘ì—…ì´ ì‹¤í–‰ë˜ë©´ ê·¸ ì‘ì—…ì´ ì™„ë£Œë  ë•Œê¹Œì§€ ë‹¤ë¥¸ í´ë¼ì´ì–¸íŠ¸ ëª…ë ¹ì–´ë¥¼ ì²˜ë¦¬í•  ìˆ˜ ì—†ìŒ â†’ ë¸”ë¡œí‚¹
- ìš´ì˜ í™˜ê²½ì—ì„œ ì‚¬ìš© ì§€ì–‘ â†’ SCAN ëª…ë ¹ì–´ë¥¼ ì‚¬ìš©í•˜ëŠ” ê²ƒì„ ê¶Œì¥

## ë¬¸ì œ ì›ì¸

> ì˜ˆì‹œ ì½”ë“œ 

```python
def get_reservation_count(self):
    """
    ì˜ˆì•½ëœ ì‚¬ìš©ì ìˆ˜ ê³„ì‚°
    """
    redis_client = cache.client.get_client(write=True)
    reservation_count = sum(1 for _ in redis_client.scan_iter(f"*{self.reservation_prefix}*"))
    return reservation_count
```

**â“Â Reservation Keyë¥¼ ì‚¬ìš©í•œ ì´ìœ **

- ì„ ì°©ìˆœ ì´ë²¤íŠ¸ì—ì„œ 100ëª… ì œí•œì„ ë‘ê³  ìˆê¸° ë•Œë¬¸ì—, í˜„ì¬ ì˜ˆì•½ëœ ì‚¬ìš©ì ìˆ˜ë¥¼ Redis í‚¤ë¡œ ê´€ë¦¬í•˜ê³  ê·¸ ìˆ˜ë¥¼ ì§‘ê³„í•˜ê¸° ìœ„í•´ **scan_iter**ë¥¼ ì‚¬ìš©í•¨
    - 99ëª…ì´ ì°¸ì—¬í•œ ìƒí™©ì—ì„œ Nëª…ì´ ë™ì‹œì— ì°¸ì—¬í•˜ëŠ” ê²½ìš° ëª¨ë‘ê°€ 100ì›ì˜ í˜œíƒì„ ë°›ê²Œë˜ë¯€ë¡œ, ì½˜ì„œíŠ¸ ìë¦¬ ì„ ì ì²˜ëŸ¼ reservation_keyì„ ê°€ì§„ ìœ ì €ê°€ 100ì› í˜œíƒì„ ë°›ì„ ìˆ˜ ìˆë„ë¡ í•˜ê¸° ìœ„í•´ ì‚¬ìš© (TTL 30ì´ˆ)
- reservation_user_id_1234 â†’ ìœ ì € idë¥¼ í¬í•¨í•œ í‚¤ë¥¼ ìƒì„±í•˜ì—¬ í•´ë‹¹ ìœ ì €ì˜ ì˜ˆì•½ ì •ë³´ë¥¼ ì €ì¥

ğŸ˜¢Â **ì„±ëŠ¥ìƒ ì´ìŠˆ**

- ìºì‹œ ì„œë²„ì— ì•½ 14ë§Œ ê°œ ì´ìƒì˜ í‚¤ê°€ ì¡´ì¬
    - count ê°’ì„ ì£¼ì§€ì•Šìœ¼ë©´ default countê°’ì€ 10ì´ê¸° ë•Œë¬¸ì—, ì•½ 14,000ë²ˆì˜ í˜¸ì¶œì´ ì¼ì–´ë‚˜ê²Œ ë¨
- í•´ë‹¹ ì½”ë“œê°€ ë©”ì¸ í™”ë©´ì—ì„œ ì§§ì€ ì£¼ê¸°ë¡œ ë°˜ë³µ í˜¸ì¶œë˜ì–´ scan ì§€ì—°ì´ ë°œìƒí–ˆìŒ 
- reservation_prefixê°€ ëª…í™•í•œ ì ‘ë‘ì‚¬/ì ‘ë¯¸ì‚¬ê°€ ì•„ë‹ˆë¼ **ì¤‘ê°„ì— ìœ„ì¹˜í•˜ëŠ” ê²½ìš°**, ë” ë§ì€ íƒìƒ‰ ë¹„ìš© O
    - ìºì‹œ ì„œë²„ì— ì €ì¥ë ë•Œ `:1:`ê°€ ì ‘ë‘ì–´ë¡œ ê°™ì´ ì €ì¥ë˜ì–´ì„œ ì•ë’¤ë¡œ ì™€ì¼ë“œì¹´ë“œ(*)ë¥¼ ì ìš©í–ˆì—ˆìŒ

> ë³€ê²½ ì½”ë“œ

```python
redis_client.scan_iter(f":1:{self.reservation_prefix}*", count=10_000)
```

- ì ì ˆí•œ countê°’ ì œê³µ + ì ‘ë‘ì–´ `:1:`ë¥¼ ì¶”ê°€

> ìƒê°í•´ë³¸ ê°œì„  ë°©í–¥

```python
reservation_key = f"event:{today_date}:reservation_user_ids"

redis_client.sadd(reservation_key, user_id)       # ì˜ˆì•½ ì¶”ê°€
redis_client.sismember(reservation_key, user_id)  # ì˜ˆì•½ ì—¬ë¶€ í™•ì¸
redis_client.scard(reservation_key)               # ì´ ì˜ˆì•½ì ìˆ˜
redis_client.expire(reservation_key, TTL)
```

- `scard`
    - ì˜ˆì•½ì ìˆ˜ í™•ì¸
    - Setì˜ í¬ê¸°ë¥¼ ì¦‰ì‹œ ë°˜í™˜
- `sismember`
    - ìœ ì € ì˜ˆì•½ ì—¬ë¶€ í™•ì¸
    - í•´ë‹¹ ìš”ì†Œê°€ Setì— í¬í•¨ë˜ì–´ ìˆëŠ”ì§€ í™•ì¸
- `sadd`
    - ì˜ˆì•½ ì¶”ê°€
    - ë™ì¼í•œ ê°’ì´ ì´ë¯¸ ì¡´ì¬í•˜ë©´ ì¶”ê°€í•˜ì§€ ì•Šê³  ë¬´ì‹œ
- ëª¨ë‘ ì‹œê°„ë³µì¡ë„ **O(1)**
- í•˜ì§€ë§Œ ê°œë³„ ìœ ì €ì˜ ì˜ˆì•½í‚¤ì˜ TTLì„ ì„¤ì •í•  ìˆ˜ ì—†ëŠ” ë¬¸ì œì  ë°œìƒ
